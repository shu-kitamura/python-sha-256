import pytest

from src.sha256 import get_words, padding


def test_padding():
    assert padding("test") == b'\x74\x65\x73\x74\x80' + (b'\x00' * 58) + b'\x04'
    assert padding("") == b'\x80' + (b'\x00' * 62) + b'\x00'
    assert padding("a" * 62) == b'\x61' * 62 + b'\x80' + b'\x3e'

    # 入力が 62 バイトを超えると ValueError が発生する
    with pytest.raises(ValueError) as e:
        padding("a" * 63)
        assert str(e.value) == "Input too long"

def test_get_words():
    words1 = [
        b'\x74\x65\x73\x74', b'\x80\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
        b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
        b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
        b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x04'
    ]
    assert get_words(b'\x74\x65\x73\x74\x80' + (b'\x00' * 58) + b'\x04') == words1

    words2 = [
        b'\x80\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
        b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
        b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
        b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00', b'\x00\x00\x00\x00',
    ]
    assert get_words(b'\x80' + (b'\x00' * 62) + b'\x00') == words2

    words3 = [
        b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61',
        b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61',
        b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61',
        b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x61\x61', b'\x61\x61\x80\x3e',
    ]
    assert get_words(b'\x61' * 62 + b'\x80' + b'\x3e') == words3

    # 入力が 64 バイトではないと ValueError が発生する
    with pytest.raises(ValueError) as e:
        get_words(b'\x61' * 63 + b'\x80' + b'\x3e')
        assert str(e.value) == "Input block must be exactly 64 bytes"

        get_words(b'\x61' * 61 + b'\x80' + b'\x3e')
        assert str(e.value) == "Input block must be exactly 64 bytes"
